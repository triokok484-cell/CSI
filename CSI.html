<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn tập Khoa học Máy tính - CSI106</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --background-color: #ffffff;
            --font-color: #212529;
            --border-color: #dee2e6;
            --border-radius: 0.3rem;
            --box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,.075);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: var(--light-color);
            color: var(--font-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            background-color: var(--background-color);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 800px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.8rem;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab-button, .btn {
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            background-color: var(--light-color);
            cursor: pointer;
            border-radius: var(--border-radius);
            margin-right: 10px;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .tab-button:hover, .btn:hover {
            opacity: 0.85;
        }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-secondary { background-color: var(--secondary-color); color: white; }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        #theory-summary {
            background-color: #fdfdff;
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            border-radius: var(--border-radius);
            max-height: 500px;
            overflow-y: auto;
        }
        #theory-summary p { margin: 0 0 10px 0; }
        #theory-summary span { font-weight: bold; color: var(--primary-color); }

        #quiz-setup { text-align: center; }
        #quiz-setup h3 { margin-top: 0; }
        #quiz-setup .btn { margin: 5px; }

        #quiz-container { text-align: center; }
        #question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            font-weight: 500;
        }
        #answers-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .answer-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 15px;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }
        .answer-btn:hover:not(:disabled) {
            background-color: var(--light-color);
        }
        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .answer-btn.correct {
            background-color: #d4edda;
            border-color: var(--success-color);
            color: #155724;
            font-weight: bold;
        }
        .answer-btn.incorrect {
            background-color: #f8d7da;
            border-color: var(--danger-color);
            color: #721c24;
        }
        #quiz-footer {
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #memory-tip {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: var(--border-radius);
            color: #856404;
        }
        
        #results-container h2 { text-align: center; }
        #score { font-size: 2rem; font-weight: bold; color: var(--primary-color); }
        #results-list { list-style-type: none; padding: 0; }
        #results-list li {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }
        .result-correct { border-left: 5px solid var(--success-color); }
        .result-incorrect { border-left: 5px solid var(--danger-color); }
        .result-question { font-weight: bold; }
        .result-answer { margin-top: 8px; }

        @media (max-width: 600px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            h1 { font-size: 1.5rem; }
            header { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 id="main-title">Ôn tập CSI106</h1>
        <button id="lang-toggle-btn" class="btn btn-secondary">Translate to English</button>
    </header>

    <div class="tabs">
        <button class="tab-button active" onclick="switchTab('theory')">Lý Thuyết</button>
        <button class="tab-button" onclick="switchTab('quiz')">Làm Quiz</button>
    </div>

    <div id="theory-content" class="tab-content active">
        <h2 id="theory-title">Tóm Tắt Lý Thuyết Cốt Lõi</h2>
        <div id="theory-summary"></div>
    </div>

    <div id="quiz-content" class="tab-content">
        <div id="quiz-setup">
            <h3 id="quiz-setup-title">Chọn số lượng câu hỏi bạn muốn làm:</h3>
            <button class="btn btn-primary" onclick="startQuiz(5)">5 Câu</button>
            <button class="btn btn-primary" onclick="startQuiz(10)">10 Câu</button>
            <button class="btn btn-primary" onclick="startQuiz(20)">20 Câu</button>
            <button class="btn btn-primary" onclick="startQuiz(50)">50 Câu</button>
            <button class="btn btn-primary" onclick="startQuiz(182)">Tất cả (182 Câu)</button>
        </div>

        <div id="quiz-container" style="display: none;">
            <p id="progress-text"></p>
            <div id="question-text"></div>
            <div id="answers-container"></div>
            <div id="memory-tip" style="display: none;"></div>
            <div id="quiz-footer">
                <div></div>
                <button id="submit-btn" class="btn btn-danger" onclick="submitQuiz()">Nộp bài</button>
            </div>
        </div>

        <div id="results-container" style="display: none;">
            <h2 id="results-title">Kết quả</h2>
            <p id="score" style="text-align: center;"></p>
            <ul id="results-list"></ul>
            <div style="text-align: center; margin-top: 20px;">
                <button id="restart-btn" class="btn btn-primary" onclick="restartQuiz()">Làm lại</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- START OF QUESTION BANK ---
const mcqBank = [
    {
        "id": 1,
        "question_vi": "Một giải pháp từng bước cho một vấn đề được gọi là _______.",
        "question_en": "A step-by-step solution to a problem is called _______.",
        "answers_vi": [
            {"text": "phần cứng", "correct": false},
            {"text": "một hệ điều hành", "correct": false},
            {"text": "một ngôn ngữ máy tính", "correct": false},
            {"text": "một thuật toán", "correct": true}
        ],
        "answers_en": [
            {"text": "hardware", "correct": false},
            {"text": "an operating system", "correct": false},
            {"text": "a computer language", "correct": false},
            {"text": "an algorithm", "correct": true}
        ],
        "tip_vi": "Thuật toán (Algorithm) là một chuỗi các hướng dẫn hoặc quy tắc được xác định rõ ràng để giải quyết một vấn đề cụ thể.",
        "tip_en": "An Algorithm is a sequence of well-defined instructions or rules to solve a specific problem."
    },
    // Chèn 181 câu hỏi còn lại vào đây...
    // Dưới đây là một vài ví dụ để bạn thấy cấu trúc
    {
        "id": 2,
        "question_vi": "Mô hình _______ là cơ sở cho các máy tính ngày nay.",
        "question_en": "The _______ model is the basis for today's computers.",
        "answers_vi": [
            {"text": "Leibnitz", "correct": false},
            {"text": "von Neumann", "correct": true},
            {"text": "Pascal", "correct": false},
            {"text": "Charles Babbage", "correct": false}
        ],
        "answers_en": [
            {"text": "Leibnitz", "correct": false},
            {"text": "von Neumann", "correct": true},
            {"text": "Pascal", "correct": false},
            {"text": "Charles Babbage", "correct": false}
        ],
        "tip_vi": "Kiến trúc von Neumann mô tả một máy tính có thể lưu trữ chương trình và dữ liệu trong cùng một bộ nhớ, đây là nền tảng của hầu hết các máy tính hiện đại.",
        "tip_en": "The von Neumann architecture describes a computer that can store both programs and data in the same memory, which is the foundation of most modern computers."
    },
     {
        "id": 13,
        "question_vi": "Trong máy tính, hệ thống con _______ lưu trữ dữ liệu và chương trình.",
        "question_en": "In a computer, the _______ subsystem stores data and programs.",
        "answers_vi": [
            {"text": "ALU", "correct": false},
            {"text": "nhập/xuất", "correct": false},
            {"text": "bộ nhớ", "correct": true},
            {"text": "đơn vị điều khiển", "correct": false}
        ],
        "answers_en": [
            {"text": "ALU", "correct": false},
            {"text": "input/output", "correct": false},
            {"text": "memory", "correct": true},
            {"text": "control unit", "correct": false}
        ],
        "tip_vi": "Bộ nhớ (Memory) là thành phần chịu trách nhiệm lưu trữ cả chỉ thị (chương trình) và dữ liệu để CPU có thể truy cập và xử lý.",
        "tip_en": "Memory is the component responsible for storing both instructions (programs) and data so the CPU can access and process them."
    },
    {
        "id": 76,
        "question_vi": "Giai đoạn _______ tạo ra một tài liệu đặc tả chỉ ra phần mềm sẽ làm gì mà không chỉ định nó sẽ được thực hiện như thế nào.",
        "question_en": "The _______ phase results in a specification document that shows what the software will do without specifying how it will be done.",
        "answers_vi": [
            {"text": "Giai đoạn phân tích", "correct": true},
            {"text": "Giai đoạn thiết kế", "correct": false},
            {"text": "Giai đoạn triển khai", "correct": false},
            {"text": "Giai đoạn kiểm thử", "correct": false}
        ],
        "answers_en": [
            {"text": "Analysis phase", "correct": true},
            {"text": "Design phase", "correct": false},
            {"text": "Implementation phase", "correct": false},
            {"text": "Testing phase", "correct": false}
        ],
        "tip_vi": "Giai đoạn Phân tích (Analysis) tập trung vào việc 'làm GÌ' (thu thập yêu cầu), trong khi giai đoạn Thiết kế (Design) tập trung vào 'làm NHƯ THẾ NÀO'.",
        "tip_en": "The Analysis phase focuses on 'WHAT' to do (gathering requirements), while the Design phase focuses on 'HOW' to do it."
    },
    {
        "id": 78,
        "question_vi": "Trong ____, nhiều hơn một chương trình nằm trong bộ nhớ cùng một lúc và chúng được thực thi đồng thời.",
        "question_en": "In ____, more than one program is in memory at the same time and they are executed concurrently.",
        "answers_vi": [
            {"text": "Hệ điều hành", "correct": false},
            {"text": "Đa chương trình", "correct": true},
            {"text": "Đơn chương trình", "correct": false},
            {"text": "Vi lập trình", "correct": false}
        ],
        "answers_en": [
            {"text": "Operating system", "correct": false},
            {"text": "Multiprogramming", "correct": true},
            {"text": "Monoprogramming", "correct": false},
            {"text": "Microprogramming", "correct": false}
        ],
        "tip_vi": "Đa chương trình (Multiprogramming) là kỹ thuật cho phép CPU chuyển đổi giữa các công việc, tối đa hóa việc sử dụng CPU bằng cách luôn có một công việc để thực thi.",
        "tip_en": "Multiprogramming is a technique that allows the CPU to switch between jobs, maximizing CPU utilization by always having a job to execute."
    },
    {
        "id": 115,
        "question_vi": "Thao tác dequeue (lấy ra khỏi hàng đợi) ___ mục ở ___ của hàng đợi.",
        "question_en": "The dequeue operation ___ the item at the ___ of the queue.",
        "answers_vi": [
            {"text": "xóa, đầu", "correct": true},
            {"text": "xóa, cuối", "correct": false},
            {"text": "chèn, đầu", "correct": false},
            {"text": "chèn, cuối", "correct": false}
        ],
        "answers_en": [
            {"text": "deletes, front", "correct": true},
            {"text": "deletes, end", "correct": false},
            {"text": "inserts, front", "correct": false},
            {"text": "inserts, rear", "correct": false}
        ],
        "tip_vi": "Hàng đợi (Queue) hoạt động theo nguyên tắc FIFO (First-In, First-Out), nghĩa là phần tử vào trước sẽ ra trước. Do đó, ta luôn lấy (dequeue) từ đầu hàng đợi.",
        "tip_en": "A Queue operates on the FIFO (First-In, First-Out) principle, meaning the first element in is the first one out. Therefore, we always dequeue from the front."
    },
    {
        "id": 167,
        "question_vi": "Một ____ là một tập hợp các phần tử liên quan, có thể thuộc các kiểu khác nhau, có chung một tên.",
        "question_en": "A ____ is a collection of related elements, possibly of different types, having a single name.",
        "answers_vi": [
            {"text": "Mảng", "correct": false},
            {"text": "Bản ghi", "correct": true},
            {"text": "Danh sách liên kết", "correct": false},
            {"text": "Cây", "correct": false}
        ],
        "answers_en": [
            {"text": "Array", "correct": false},
            {"text": "Record", "correct": true},
            {"text": "Linked list", "correct": false},
            {"text": "Tree", "correct": false}
        ],
        "tip_vi": "Bản ghi (Record), hay struct, cho phép nhóm các loại dữ liệu khác nhau (ví dụ: tên, tuổi, điểm số) lại với nhau dưới một tên duy nhất.",
        "tip_en": "A Record, or struct, allows grouping of different data types (e.g., name, age, score) together under a single name."
    }
    // LƯU Ý: Do giới hạn độ dài, tôi chỉ chèn một vài câu mẫu. 
    // Bạn cần sao chép và dán toàn bộ 182 câu hỏi đã được định dạng vào đây.
];
// --- END OF QUESTION BANK ---


// State variables
let currentLanguage = 'vi';
let quizQuestions = [];
let currentQuestionIndex = 0;
let score = 0;
let userAnswers = [];
let totalQuestionsSelected = 0;
let theorySummaries = {};

// UI Elements
const langBtn = document.getElementById('lang-toggle-btn');
const theoryContent = document.getElementById('theory-content');
const quizContent = document.getElementById('quiz-content');
const theorySummaryDiv = document.getElementById('theory-summary');
const quizSetupDiv = document.getElementById('quiz-setup');
const quizContainerDiv = document.getElementById('quiz-container');
const resultsContainerDiv = document.getElementById('results-container');
const questionTextDiv = document.getElementById('question-text');
const answersContainerDiv = document.getElementById('answers-container');
const progressTextP = document.getElementById('progress-text');
const memoryTipDiv = document.getElementById('memory-tip');
const resultsListUl = document.getElementById('results-list');
const scoreP = document.getElementById('score');

// --- THEORY TAB LOGIC ---
function generateTheorySummary() {
    let summary_vi = '';
    let summary_en = '';
    
    // You can manually add more summaries here
    const keyPoints = [
        {vi: 'Một giải pháp từng bước cho một vấn đề gọi là', en: 'A step-by-step solution to a problem is called', answer_vi: 'Thuật toán.', answer_en: 'an Algorithm.'},
        {vi: 'Mô hình là cơ sở cho các máy tính ngày nay', en: 'The model that is the basis for today\'s computers is', answer_vi: 'von Neumann.', answer_en: 'the von Neumann model.'},
        {vi: 'Hệ thống con lưu trữ dữ liệu và chương trình là', en: 'The subsystem that stores data and programs is', answer_vi: 'Bộ nhớ (Memory).', answer_en: 'Memory.'},
        {vi: 'Dữ liệu trong RAM sẽ bị xóa khi', en: 'Data in RAM is erased when', answer_vi: 'mất điện.', answer_en: 'the power is turned off.'},
        {vi: 'Một byte bao gồm', en: 'A byte consists of', answer_vi: '8 bit.', answer_en: '8 bits.'},
        {vi: 'Phương pháp biểu diễn số nguyên phổ biến nhất là', en: 'The most common method for integer representation is', answer_vi: 'Bù 2 (Two\'s complement).', answer_en: 'Two\'s complement.'},
        {vi: 'Giai đoạn xác định yêu cầu trong vòng đời phần mềm là', en: 'The phase for defining requirements in the software lifecycle is', answer_vi: 'Giai đoạn Phân tích (Analysis).', answer_en: 'the Analysis phase.'},
        {vi: 'Hệ điều hành cho phép nhiều chương trình trong bộ nhớ cùng lúc gọi là', en: 'An OS that allows multiple programs in memory at once is called', answer_vi: 'Đa chương trình (Multiprogramming).', answer_en: 'Multiprogramming.'},
        {vi: 'Cấu trúc dữ liệu hoạt động theo nguyên tắc "Vào sau, Ra trước" (LIFO) là', en: 'The data structure that operates on a "Last-In, First-Out" (LIFO) principle is', answer_vi: 'Ngăn xếp (Stack).', answer_en: 'a Stack.'},
        {vi: 'Cấu trúc dữ liệu hoạt động theo nguyên tắc "Vào trước, Ra trước" (FIFO) là', en: 'The data structure that operates on a "First-In, First-Out" (FIFO) principle is', answer_vi: 'Hàng đợi (Queue).', answer_en: 'a Queue.'}
    ];

    keyPoints.forEach(point => {
        summary_vi += `<p><span>${point.vi}:</span> ${point.answer_vi}</p>`;
        summary_en += `<p><span>${point.en}:</span> ${point.answer_en}</p>`;
    });

    theorySummaries = { vi: summary_vi, en: summary_en };
}

function renderTheory() {
    theorySummaryDiv.innerHTML = theorySummaries[currentLanguage];
}

// --- LANGUAGE TOGGLE LOGIC ---
function toggleLanguage() {
    currentLanguage = (currentLanguage === 'vi') ? 'en' : 'vi';
    updateAllUIText();
    // Re-render content if visible
    if (theoryContent.classList.contains('active')) {
        renderTheory();
    }
    if (quizContainerDiv.style.display !== 'none') {
        renderCurrentQuestion();
    }
     if (resultsContainerDiv.style.display !== 'none') {
        showResults(); // Re-render results in new language
    }
}

function updateAllUIText() {
    const isVietnamese = currentLanguage === 'vi';
    const uiText = {
        mainTitle: { vi: 'Ôn tập CSI106', en: 'CSI106 Review' },
        langBtn: { vi: 'Translate to English', en: 'Dịch sang tiếng Việt' },
        theoryTab: { vi: 'Lý Thuyết', en: 'Theory' },
        quizTab: { vi: 'Làm Quiz', en: 'Quiz' },
        theoryTitle: { vi: 'Tóm Tắt Lý Thuyết Cốt Lõi', en: 'Core Theory Summary' },
        quizSetupTitle: { vi: 'Chọn số lượng câu hỏi bạn muốn làm:', en: 'Select the number of questions you want to do:' },
        quizSetupBtn5: { vi: '5 Câu', en: '5 Questions' },
        quizSetupBtnAll: { vi: 'Tất cả (182 Câu)', en: 'All (182 Questions)' },
        submitBtn: { vi: 'Nộp bài', en: 'Submit' },
        resultsTitle: { vi: 'Kết quả', en: 'Results' },
        restartBtn: { vi: 'Làm lại', en: 'Restart' }
    };

    document.getElementById('main-title').textContent = uiText.mainTitle[currentLanguage];
    langBtn.textContent = uiText.langBtn[currentLanguage];
    document.querySelector('.tab-button[onclick="switchTab(\'theory\')"]').textContent = uiText.theoryTab[currentLanguage];
    document.querySelector('.tab-button[onclick="switchTab(\'quiz\')"]').textContent = uiText.quizTab[currentLanguage];
    document.getElementById('theory-title').textContent = uiText.theoryTitle[currentLanguage];
    document.getElementById('quiz-setup-title').textContent = uiText.quizSetupTitle[currentLanguage];
    // This is just an example for buttons, you'd do this for all of them
    document.querySelector('#quiz-setup .btn[onclick="startQuiz(5)"]').textContent = uiText.quizSetupBtn5[currentLanguage];
    document.querySelector('#quiz-setup .btn[onclick="startQuiz(182)"]').textContent = uiText.quizSetupBtnAll[currentLanguage];
    
    document.getElementById('submit-btn').textContent = uiText.submitBtn[currentLanguage];
    document.getElementById('results-title').textContent = uiText.resultsTitle[currentLanguage];
    document.getElementById('restart-btn').textContent = uiText.restartBtn[currentLanguage];
}


// --- TAB SWITCHING LOGIC ---
function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
    document.getElementById(`${tabName}-content`).classList.add('active');
    document.querySelector(`.tab-button[onclick="switchTab('${tabName}')"]`).classList.add('active');
}

// --- QUIZ LOGIC ---
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function startQuiz(numQuestions) {
    totalQuestionsSelected = Math.min(numQuestions, mcqBank.length);
    score = 0;
    currentQuestionIndex = 0;
    userAnswers = new Array(totalQuestionsSelected).fill(null);
    
    let shuffledBank = shuffleArray([...mcqBank]);
    quizQuestions = shuffledBank.slice(0, totalQuestionsSelected);

    quizSetupDiv.style.display = 'none';
    resultsContainerDiv.style.display = 'none';
    quizContainerDiv.style.display = 'block';

    renderCurrentQuestion();
}

function renderCurrentQuestion() {
    if (currentQuestionIndex >= quizQuestions.length) return;
    
    const questionData = quizQuestions[currentQuestionIndex];
    const questionLang = currentLanguage === 'vi' ? 'question_vi' : 'question_en';
    const answersLang = currentLanguage === 'vi' ? 'answers_vi' : 'answers_en';
    
    progressTextP.textContent = `${currentLanguage === 'vi' ? 'Câu' : 'Question'} ${currentQuestionIndex + 1} / ${totalQuestionsSelected}`;
    questionTextDiv.textContent = questionData[questionLang];
    answersContainerDiv.innerHTML = '';
    memoryTipDiv.style.display = 'none';
    
    const answers = shuffleArray([...questionData[answersLang]]);
    
    answers.forEach(answer => {
        const button = document.createElement('button');
        button.className = 'answer-btn';
        button.innerHTML = answer.text; // Use innerHTML to render potential formatting
        button.onclick = () => selectAnswer(button, answer.correct, answer.text);
        answersContainerDiv.appendChild(button);
    });
}

function selectAnswer(selectedButton, isCorrect, selectedText) {
    // Disable all buttons
    document.querySelectorAll('.answer-btn').forEach(btn => btn.disabled = true);
    
    // Store user's answer
    userAnswers[currentQuestionIndex] = {
        text: selectedText,
        isCorrect: isCorrect
    };

    if (isCorrect) {
        score++;
        selectedButton.classList.add('correct');
    } else {
        selectedButton.classList.add('incorrect');
        // Find and highlight the correct answer
        const correctText = quizQuestions[currentQuestionIndex][currentLanguage === 'vi' ? 'answers_vi' : 'answers_en'].find(a => a.correct).text;
        document.querySelectorAll('.answer-btn').forEach(btn => {
            if (btn.innerHTML === correctText) {
                btn.classList.add('correct');
            }
        });
        // Show memory tip
        const tipLang = currentLanguage === 'vi' ? 'tip_vi' : 'tip_en';
        memoryTipDiv.textContent = `${currentLanguage === 'vi' ? 'Mẹo ghi nhớ' : 'Memory Tip'}: ${quizQuestions[currentQuestionIndex][tipLang]}`;
        memoryTipDiv.style.display = 'block';
    }
    
    // Move to next question after a delay
    setTimeout(nextQuestion, 2500);
}

function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < quizQuestions.length) {
        renderCurrentQuestion();
    } else {
        showResults();
    }
}

function submitQuiz() {
    showResults();
}

function showResults() {
    quizContainerDiv.style.display = 'none';
    resultsContainerDiv.style.display = 'block';
    
    const scoreText = currentLanguage === 'vi' ? `Bạn đã trả lời đúng ${score} trên ${totalQuestionsSelected} câu!` : `You answered ${score} out of ${totalQuestionsSelected} questions correctly!`;
    scoreP.textContent = scoreText;
    
    resultsListUl.innerHTML = '';
    quizQuestions.forEach((question, index) => {
        const li = document.createElement('li');
        const userAnswer = userAnswers[index];
        const questionLang = currentLanguage === 'vi' ? 'question_vi' : 'question_en';
        const answersLang = currentLanguage === 'vi' ? 'answers_vi' : 'answers_en';
        const correctAnswerText = question[answersLang].find(a => a.correct).text;

        let resultHTML = `<div class="result-question">${index + 1}. ${question[questionLang]}</div>`;
        
        if (userAnswer) {
            li.classList.add(userAnswer.isCorrect ? 'result-correct' : 'result-incorrect');
            const yourAnswerText = currentLanguage === 'vi' ? 'Câu trả lời của bạn' : 'Your answer';
            const statusText = userAnswer.isCorrect 
                ? (currentLanguage === 'vi' ? ' (Đúng)' : ' (Correct)')
                : (currentLanguage === 'vi' ? ' (Sai)' : ' (Incorrect)');
            resultHTML += `<div class="result-answer">${yourAnswerText}: ${userAnswer.text} ${statusText}</div>`;
            if (!userAnswer.isCorrect) {
                const correctAnswerLabel = currentLanguage === 'vi' ? 'Đáp án đúng' : 'Correct answer';
                resultHTML += `<div class="result-answer">${correctAnswerLabel}: ${correctAnswerText}</div>`;
            }
        } else { // Skipped question
            li.classList.add('result-incorrect');
            const unansweredText = currentLanguage === 'vi' ? '[Chưa trả lời]' : '[Unanswered]';
             const correctAnswerLabel = currentLanguage === 'vi' ? 'Đáp án đúng' : 'Correct answer';
            resultHTML += `<div class="result-answer">${unansweredText}</div>`;
            resultHTML += `<div class="result-answer">${correctAnswerLabel}: ${correctAnswerText}</div>`;
        }
        
        li.innerHTML = resultHTML;
        resultsListUl.appendChild(li);
    });
}

function restartQuiz() {
    resultsContainerDiv.style.display = 'none';
    quizSetupDiv.style.display = 'block';
}

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    langBtn.addEventListener('click', toggleLanguage);
    generateTheorySummary();
    renderTheory();
    updateAllUIText();
});

</script>
</body>
</html>